#!/bin/sh

loadConfig() {
  if [ -f "$config" ]; then
    source "$config"
  else
    mkdir -p "$(dirname "$config")"
    touch "$config"
  fi
}

help() {
  printf "ISP Manager 1.0, a CLI tool for captive portals\n"
  printf "Usage: ispmgr [OPTION]...\n\n"
  printf "init        start the setup wizard"
  printf "\n--help      display this help section\n"

  exit 0
}

init() {
  read -rp "Captive Portal URL: " url
  echo "firstRun=1" >> "$config"
  echo "url=$url" >> "$config"
  loadConfig
}

checkRun() {
  if [ "$firstRun" = "" ]; then
    printf "ispmgr: run 'ispmgr init' first\n"
    printf "Try 'ispmgr --help' for more options.\n"
    exit 1
  fi
}

inputData() {
  if [ "$cookie" = "" ]; then
    read -rp "Username: " username
    read -srp "Password: " password && echo
    read -rp "Save Credentials? (Y/n): " remember
    case $remember in
      ""|[Yy])
        echo "cookie=1" >> "$config"
        echo "username=$username" >> "$config"
        echo "password=$password" >> "$config"
        loadConfig
      ;;

      [Nn])
        printf ""
      ;;

      *)
        printf "Please enter a valid choice."
        exit 0
      ;;
    esac
  fi
}

config="$HOME/.config/ispmgr.conf"
loadConfig

case $1 in
  '')
    printf "ispmgr: please supply an argument\n"
    checkRun
    printf "Try 'ispmgr --help' for more options.\n"
    exit 1
  ;;
  'init')
    init
  ;;

  '--help')
    help
  ;;
  
  *)
    printf "ispmgr: unrecognized option '"$1"'\n"
    checkRun
    printf "Try 'ispmgr --help' for more options.\n"
    exit 1
  ;;
esac
